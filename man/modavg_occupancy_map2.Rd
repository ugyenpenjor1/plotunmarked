% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/modavg_occupancy_map2.R
\name{modavg_occupancy_map2}
\alias{modavg_occupancy_map2}
\title{Model-averaged occupancy prediction and mapping}
\usage{
modavg_occupancy_map2(
  d2_mod_list,
  pred_cov_stack,
  agg_factor = 4,
  plot_ci = FALSE,
  save_plot = FALSE,
  plot_filename = "occupancy_map",
  plot_format = "png"
)
}
\arguments{
\item{d2_mod_list}{A list of fitted occupancy models (from \code{unmarked::occu()}),
created with the same dataset and covariate names as used in \code{pred_cov_stack}.}

\item{pred_cov_stack}{A \code{terra::SpatRaster} or \code{raster::RasterStack}/\code{RasterBrick}
of scaled covariates used for prediction. Layer names must match model covariates.}

\item{agg_factor}{Integer. Factor by which to spatially aggregate the prediction raster
for efficiency (default is 4). Use 1 to skip aggregation.}

\item{plot_ci}{Logical. If \code{TRUE}, plots 95\% confidence intervals for predictions.
Default is \code{FALSE}.}

\item{save_plot}{Logical. If \code{TRUE}, saves the generated plot to disk. Default is \code{FALSE}.}

\item{plot_filename}{Character. File name (without extension) to save the plot if \code{save_plot = TRUE}.
Default is \code{"occupancy_map"}.}

\item{plot_format}{Character. Format of the saved plot (e.g., \code{"png"}, \code{"pdf"}). Default is \code{"png"}.}
}
\value{
An invisible list containing:
\describe{
\item{\code{pred_df}}{A \code{data.frame} with x, y coordinates and predicted occupancy values with uncertainty.}
\item{\code{pred_raster}}{A \code{terra::SpatRaster} with the predicted occupancy surface.}
\item{\code{mod_avg_pred}}{A list with numeric vectors of model-averaged predictions and standard errors.}
}
}
\description{
Generates model-averaged occupancy predictions across a spatial landscape using
a list of fitted occupancy models (\code{unmarked} objects) and a raster stack of covariates.
The function supports polynomial and interaction terms used in occupancy formulas,
performs raster aggregation for computational efficiency, and optionally plots
the predictions with uncertainty estimates.
}
\details{
The function parses each model formula to identify any polynomial (e.g., \code{I(elev^2)})
or interaction (e.g., \code{elev:forest}) terms and automatically generates those terms
in the prediction dataset. This ensures that \code{modavgPred()} from \code{AICcmodavg} can
correctly evaluate predictions even when complex terms are used.
}
\note{
Covariates in \code{pred_cov_stack} must already be scaled consistently with those
used in model fitting.
}
\examples{
\dontrun{
# Assume d2_mod_list is a list of fitted occu models
# and pred_cov_stack is a SpatRaster of scaled covariates
result <- modavg_occupancy_map2(
  d2_mod_list = d2_mod_list,
  pred_cov_stack = terra_list1,
  agg_factor = 4,
  plot_ci = TRUE,
  save_plot = TRUE,
  plot_filename = "map_output",
  plot_format = "png"
)
}
}
